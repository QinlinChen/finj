/* Generated by genhack.py */
#ifndef _FINJ_HOOK_H
#define _FINJ_HOOK_H

#define ARRAY_LEN(x)   (sizeof(x) / sizeof((x)[0]))
#define RAND_CHOOSE_FROM(x) ((x)[rand() % ARRAY_LEN(x)])

int checkpoint(const char *funcname, const char *file,
               const char *caller, int line);

{% for func_info in func_infos -%}
#ifndef {{ func_info.name }}
#define {{ func_info.name }}(...) \
({ \
    {{ func_info.ret_type }} __finj_ret; \
    if (checkpoint("{{ func_info.name }}", __FILE__, __func__, __LINE__)) { \
{%- if func_info.errnos %}
        int __finj_table[] = { \
            {{ func_info.errnos_str() }} \
        }; \
        errno = RAND_CHOOSE_FROM(__finj_table); \
        __finj_ret = {{ func_info.ret_val }}; \
{%- endif %}
    } \
    else { \
        __finj_ret = {{func_info.name }}(__VA_ARGS__); \
    } \
    __finj_ret; \
})
#endif /* {{ func_info.name }} */

{% endfor %}

#endif /* _FINJ_HOOK_H */